<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">

    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <!------ Include the above in your HEAD tag ---------->
    <link rel="stylesheet" href="/static/dashboard.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
</head>
<body>
    <div class="container">
        <header class="blog-header py-3">
            <div class="row flex-nowrap justify-content-between align-items-center">
                <div class="col-4 pt-1">
                    <a class="text-muted" href="#"></a>
                </div>
                <div class="col-4 text-center">
                    <h3 class="blog-header-logo text-dark" href="#">Large</h3>
                </div>
                <div class="col-4 d-flex justify-content-end align-items-center">
                    <a class="text-muted" href="#">
                        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-3">
                            <circle cx="10.5" cy="10.5" r="7.5"></circle>
                            <line x1="21" y1="21" x2="15.8" y2="15.8"></line>
                        </svg> -->
                    </a>
                    <a class="btn btn-sm btn-outline-secondary" href="http://localhost:8000/login">Sign in</a>
                    <img id="logout" src="/static/logout.png" onclick="logout()" title="logout icon" width="22px" height="22px" style="display: none;">
                </div>
            </div>
        </header>
        <div class="nav-scroller py-1 mb-2">
            <nav class="nav d-flex justify-content-between">
                <a class="p-2 text-muted" href="http://localhost:8000/dashboard">Dashboard</a>
                <a class="p-2 text-muted" href="http://localhost:8000/orders">Orders</a>
                <a class="p-2 text-muted" href="http://localhost:8000/currencies">Currencies</a>
            </nav>
        </div>
<div class="container">
<hr>
<div class="row d-flex justify-content-center">
	<aside class="col-sm-4">
<div class="card">
<article class="card-body">
<a href="http://localhost:8000/register" class="float-right btn btn-outline-primary">Sign up</a>
<h4 class="card-title mb-4 mt-1">Sign in</h4>
    <form id="signinForm">
    <div class="form-group">
    	<label>Your email</label>
        <input name="email" class="form-control" type="email" required>
    </div> <!-- form-group// -->
    <div class="form-group">
    	<label>Your password</label>
        <input name="password" class="form-control" type="password" required>
    </div> <!-- form-group// -->  
    <div class="form-group">
        <button id="loginButton" type="submit" class="btn btn-primary btn-block">Login</button>
    </div> <!-- form-group// -->                                                           
</form>
</article>
</div> <!-- card.// -->
  </aside>
  </div>

<script>
$(document).ready(function() {
    $('#signinForm').submit(function(event) {
        event.preventDefault(); // Prevent the form from submitting normally
        // Get the form data
        var formData = {
            username: $('input[name="email"]').val(),
            password: $('input[name="password"]').val(),
        };

        var serializedData = $.param(formData);
        console.log(serializedData)
        // Send the form data to the backend
        $.ajax({
            url: 'http://localhost:8000/auth/login',    // Specify the URL of your backend API
            method: 'POST',         // Specify the HTTP method as POST
            contentType: 'application/x-www-form-urlencoded',  // Specify the content type as JSON
            data: serializedData,   // Convert the form data object to JSON string
            success: function(response) {
                // Handle the successful response from the backend
                window.location.href = "http://localhost:8000/dashboard";
                // Save the token in the local storage
                localStorage.setItem('token', response.access_token);
            },
            error: function(xhr, status, error) {
                // Handle the error response from the backend
                if (xhr.status >= 400 && xhr.status < 500) {
                    // Display modal with error text
                    disableForm(xhr.responseJSON.detail)
                } else if (xhr.status >= 500 && xhr.status < 600) {
                    // Display "Server error" modal
                    disableForm("Server error")
                }
            }
        });
    });
});
function disableForm(text) {
        const loginButton = document.querySelector("#loginButton");
        const verificationTextExist = document.querySelector("#verText");
        if (!verificationTextExist) {
            const verificationText = document.createElement("p");
            verificationText.id = "verText";
            verificationText.textContent = text;
            verificationText.style.color = "red";
            loginButton.parentNode.insertBefore(verificationText, loginButton);
        }
        else {
            verificationTextExist.textContent = text;
        }
  
      }
</script>
</body>
</html>