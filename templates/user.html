<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
        <!-- jQuery library -->
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
        <!-- Popper JS -->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <!-- Latest compiled JavaScript -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="/static/dashboard.css">
        <title>User</title>
        <!-- Bootstrap core CSS -->
        <!-- Custom styles for this template -->
    </head>
    <body>
        <div class="container">
            <header class="blog-header py-3">
                <div class="row flex-nowrap justify-content-between align-items-center">
                    <div class="col-4 pt-1">
                        <a class="text-muted" href="#"></a>
                    </div>
                    <div class="col-4 text-center">
                        <h3 class="blog-header-logo text-dark" href="#">Large</h3>
                    </div>
                    <div class="col-4 d-flex justify-content-end align-items-center">
                        <a class="text-muted" href="#">
                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-3">
                                <circle cx="10.5" cy="10.5" r="7.5"></circle>
                                <line x1="21" y1="21" x2="15.8" y2="15.8"></line>
                            </svg> -->
                        </a>
                        <a class="btn btn-sm btn-outline-secondary" href="http://localhost:8000/login">Sign in</a>
                        <img id="logout" src="/static/logout.png" onclick="logout()" title="logout icon" width="22px" height="22px" style="display: none;">
                    </div>
                </div>
            </header>
            <div class="nav-scroller py-1 mb-2">
                <nav class="nav d-flex justify-content-between">
                    <a class="p-2 text-muted" href="http://localhost:8000/dashboard">Dashboard</a>
                    <a class="p-2 text-muted" href="http://localhost:8000/orders">Orders</a>
                    <a class="p-2 text-muted" href="http://localhost:8000/currencies">Currencies</a>
                </nav>
            </div>
<div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <div class="text-center">
              <h4 class="mb-0" id="userName"></h4>
              <p class="text-muted" id="userDate"></p>
              <div class="mb-3">
                <span class="badge" id="userVerify">Verified</span>
              </div>
              <!-- <img src="https://www.countryflags.io/us/flat/24.png" alt="US flag" class="me-2" /> -->
              <span id="userCountry"></span>
            </div>
            <hr />
            <div class="row">
              <div class="col-md-6">
                <p class="mb-0" id="userEmail"><strong>Email:</strong></p>
              </div>
              <div class="col-md-6">
                <p class="mb-0" id="userBalance"><strong>Balance:</strong></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<hr>
  <div class="container">
    <h1>
        <div class="container"></div>
        Wallet
    </h1>
    <div class="row">
        <div class="col">
            <h5><strong>Name</strong></h5>
        </div>
        <div class="col">
            <h5><strong>Quantity</strong></h5>
        </div>
    </div>
    <div id="walletCurr" class="row hover-div">
    </div>
    <!-- Loop through orders and generate grid rows -->
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0"></script>
<script>
    $(document).ready(function() {
        s=>["TKKYKGPR"[i="ATFCOMCYMMYTPRKSGSSPMSRBALAATABLRBENBIHMACESTGNBIRLISRSVNUKR".search(s)/3]||s[0],"FMYTPSMSXQYJAOEWELIA"[i]||s[2-Buffer(`Z&:^*Wf&*/1*EKe'(1#/.534aq>HI*"#0551(C=J@75%,.I>"!G0"2#1)%)(2p#/4@!&<`).every(n=>q-=n-32,q=parseInt(s,36)*5%1601)]];
        // Make AJAX request to get user information
        var token = localStorage.getItem("token");
        // Decode the JWT token to access the "name" claim
        var base64Url = token.split(".")[1];
        var base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        var jsonPayload = decodeURIComponent(atob(base64).split("").map(function(c) {
            return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(""));

        var user_id = JSON.parse(jsonPayload).id;

        $.ajax({
            url: `http://localhost:8000/user/${user_id}`,
            method: "GET",
            success: function(user) {
                // Populate user information in the template
                $(".card-body h4").text(user.name);
                $("#userVerify").text(user.verified ? "Verified" : "Not Verified");
                $(".card-body p.text-muted").text("Birthdate: " + user.birthdate);
                if (user.verified) {
                    $("#userVerify").addClass("bg-success");
                }
                else {
                    $("#userVerify").addClass("bg-danger");
                }
                // $(".card-body img.me-2").attr("src", user.flag);
                $("#userCountry").text(user.country.name);
                $("#userEmail").text(`Email: ${user.email}`);
                $("#userBalance").text(`Balance: $${user.balance}`);
            },
            error: function() {
                console.log("Error occurred while fetching user information.");
            }
        });

        // Make AJAX request to get wallet information
        $.ajax({
            url: `http://localhost:8000/wallet/${user_id}`,
            method: "GET",
            success: function(wallet) {
                // Populate wallet information in the template
                $.each(wallet, function(index, coin) {
                    var row = $("<div class='row'></div>");
                    var col1 = $("<div class='col'><h2></h2></div>").text(coin.currency.name);
                    var col2 = $("<div class='col'></div>").text(coin.quantity);

                    row.append(col1, col2);
                    $("#walletCurr").after(row);
                });
            },
            error: function() {
                console.log("Error occurred while fetching wallet information.");
            }
        });
    });
</script>
  <script src="/static/script.js"></script>
  <script src="/static/notlogged.js"></script>
</body>
</html>